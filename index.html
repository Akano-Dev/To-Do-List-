<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Cute To-Do ‚ú®</title>
    <link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" shape-rendering="crispEdges"><rect width="16" height="16" fill="%23ffeef7"/><g><rect x="3" y="2" width="2" height="2" fill="%23333"/><rect x="11" y="2" width="2" height="2" fill="%23333"/><rect x="4" y="4" width="8" height="6" fill="%23ff9dbb"/><rect x="5" y="5" width="1" height="1" fill="%23333"/><rect x="10" y="5" width="1" height="1" fill="%23333"/><rect x="7" y="7" width="2" height="1" fill="%23333"/><rect x="6" y="9" width="4" height="1" fill="%23ffc1d4"/><rect x="3" y="8" width="1" height="2" fill="%23ff9dbb"/><rect x="12" y="8" width="1" height="2" fill="%23ff9dbb"/><rect x="4" y="10" width="8" height="2" fill="%23ffa9c6"/></g></svg>'/>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            background: linear-gradient(135deg, #ffb3e6 0%, #c7ceea 50%, #a8e6cf 100%);
            min-height: 100vh;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><text y="16" font-size="16">‚≠ê</text></svg>'), auto;
            overflow-x: hidden;
        }

        /* Pixel background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 182, 193, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 80% 40%, rgba(255, 192, 203, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 40% 80%, rgba(255, 218, 185, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 60% 10%, rgba(221, 160, 221, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 10% 70%, rgba(255, 182, 193, 0.3) 2px, transparent 2px),
                radial-gradient(circle at 90% 80%, rgba(255, 192, 203, 0.3) 2px, transparent 2px);
            background-size: 50px 50px, 80px 80px, 60px 60px, 70px 70px, 40px 40px, 90px 90px;
            pointer-events: none;
            z-index: -1;
        }

        /* Main container */
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
        }

        /* Retro window header */
        .window-header {
            background: linear-gradient(145deg, #ff9a9e, #fecfef);
            border: 3px solid #333;
            border-radius: 0;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 
                0 8px 0 #666,
                inset 0 2px 0 rgba(255, 255, 255, 0.3),
                inset 0 -2px 0 rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .window-header::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff6b9d, #c44569, #f8b500, #ff6b9d);
            border-radius: 0;
            z-index: -1;
            animation: rainbow-border 3s linear infinite;
        }

        @keyframes rainbow-border {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .title {
            text-align: center;
            font-size: 18px;
            color: #333;
            text-shadow: 2px 2px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;
            animation: bounce 2s ease-in-out infinite;
        }

        /* Audio controls */
        .audio-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .audio-btn {
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            padding: 8px 10px;
            border: 2px solid #333;
            background: linear-gradient(145deg, #ffd93d, #ffb347);
            box-shadow: 0 3px 0 #666;
            cursor: pointer;
        }
        .audio-btn:active { transform: translateY(1px); box-shadow: 0 1px 0 #666; }
        .audio-slider {
            -webkit-appearance: none;
            width: 120px;
            height: 10px;
            background: #fff;
            border: 2px solid #333;
            box-shadow: inset 2px 2px 0 #ccc;
        }
        .audio-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #ff9a9e;
            border: 2px solid #333;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        /* Main to-do interface */
        .todo-container {
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #333;
            border-radius: 0;
            padding: 20px;
            box-shadow: 
                0 8px 0 #666,
                inset 0 2px 0 rgba(255, 255, 255, 0.5),
                inset 0 -2px 0 rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        /* Input section */
        .input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .task-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            border: 2px solid #333;
            border-radius: 0;
            background: #fff;
            box-shadow: inset 2px 2px 0 #ccc;
            transition: all 0.2s ease;
        }

        .task-input:focus {
            outline: none;
            border-color: #ff6b9d;
            box-shadow: inset 2px 2px 0 #ffb3e6, 0 0 0 3px rgba(255, 107, 157, 0.3);
        }

        /* Pixel buttons */
        .pixel-btn {
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            padding: 12px 15px;
            border: 2px solid #333;
            border-radius: 0;
            background: linear-gradient(145deg, #ff9a9e, #fecfef);
            color: #333;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><text y="16" font-size="16">üëÜ</text></svg>'), auto;
            transition: all 0.1s ease;
            box-shadow: 0 4px 0 #666;
            text-shadow: 1px 1px 0 #fff;
            position: relative;
            overflow: hidden;
        }

        .pixel-btn:hover {
            background: linear-gradient(145deg, #ff8a95, #fec0ef);
            transform: translateY(-1px);
            box-shadow: 0 5px 0 #666;
        }

        .pixel-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #666;
        }

        .pixel-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .pixel-btn:hover::before {
            left: 100%;
        }

        .add-btn {
            background: linear-gradient(145deg, #a8e6cf, #88d8a3);
        }

        .add-btn:hover {
            background: linear-gradient(145deg, #98d6bf, #78c893);
        }

        .clear-btn {
            background: linear-gradient(145deg, #ffb3ba, #ffdfba);
        }

        .clear-btn:hover {
            background: linear-gradient(145deg, #ffa3aa, #ffcfaa);
        }

        /* Task list */
        .task-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #333;
            border-radius: 0;
            margin-bottom: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 0 #666;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #666;
        }

        .task-item.completed {
            background: rgba(168, 230, 207, 0.8);
            text-decoration: line-through;
            opacity: 0.7;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-radius: 0;
            background: #fff;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><text y="16" font-size="16">üëÜ</text></svg>'), auto;
            position: relative;
            transition: all 0.2s ease;
        }

        .task-checkbox:checked {
            background: #a8e6cf;
            border-color: #88d8a3;
        }

        .task-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-size: 12px;
            font-weight: bold;
        }

        .task-text {
            flex: 1;
            font-size: 10px;
            color: #333;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .edit-btn, .delete-btn {
            width: 30px;
            height: 30px;
            border: 2px solid #333;
            border-radius: 0;
            font-size: 8px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><text y="16" font-size="16">üëÜ</text></svg>'), auto;
            transition: all 0.2s ease;
            box-shadow: 0 2px 0 #666;
        }

        .edit-btn {
            background: linear-gradient(145deg, #ffd93d, #ffb347);
        }

        .edit-btn:hover {
            background: linear-gradient(145deg, #ffc92d, #ffa337);
            transform: translateY(-1px);
            box-shadow: 0 3px 0 #666;
        }

        .delete-btn {
            background: linear-gradient(145deg, #ff6b6b, #ff8e8e);
        }

        .delete-btn:hover {
            background: linear-gradient(145deg, #ff5b5b, #ff7e7e);
            transform: translateY(-1px);
            box-shadow: 0 3px 0 #666;
        }

        .edit-btn:active, .delete-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 0 #666;
        }

        /* Edit input */
        .edit-input {
            flex: 1;
            padding: 8px 10px;
            font-family: 'Press Start 2P', monospace;
            font-size: 9px;
            border: 2px solid #333;
            border-radius: 0;
            background: #fff;
            box-shadow: inset 2px 2px 0 #ccc;
        }

        .edit-input:focus {
            outline: none;
            border-color: #ffd93d;
            box-shadow: inset 2px 2px 0 #ffb347, 0 0 0 2px rgba(255, 217, 61, 0.3);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 10px;
            line-height: 1.6;
        }

        .empty-state::before {
            content: '‚ú®';
            display: block;
            font-size: 30px;
            margin-bottom: 15px;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        /* Scrollbar styling */
        .task-list::-webkit-scrollbar {
            width: 12px;
        }

        .task-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border: 2px solid #333;
            border-radius: 0;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: linear-gradient(145deg, #ff9a9e, #fecfef);
            border: 2px solid #333;
            border-radius: 0;
        }

        .task-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(145deg, #ff8a95, #fec0ef);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 10px;
            }
            
            .title {
                font-size: 14px;
            }
            
            .input-section {
                flex-direction: column;
            }
            
            .task-input {
                min-width: auto;
            }
            
            .pixel-btn {
                font-size: 7px;
                padding: 10px 12px;
            }
        }

        /* Animation for task removal */
        .task-item.removing {
            animation: slideOut 0.3s ease-in forwards;
        }

        @keyframes slideOut {
            to {
                opacity: 0;
                transform: translateX(20px);
                height: 0;
                margin: 0;
                padding: 0;
            }
        }

        /* Wobble on complete */
        .task-item.completed { animation: wobble .4s ease; }
        @keyframes wobble {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            50% { transform: rotate(1deg); }
            100% { transform: rotate(0deg); }
        }

        /* Floating hearts animation */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .heart {
            position: absolute;
            color: #ff6b9d;
            font-size: 20px;
            animation: float 3s ease-in-out infinite;
            opacity: 0;
        }
        
        /* Pixel mascots */
        .mascot-strip {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 900;
            pointer-events: none;
        }

        .mascot {
            width: 40px;
            height: 40px;
            image-rendering: pixelated;
            filter: drop-shadow(0 2px 0 #666) drop-shadow(0 0 6px rgba(255,255,255,0.6));
            animation: bob 2.5s ease-in-out infinite;
        }

        .mascot:nth-child(2) { animation-delay: .2s; }
        .mascot:nth-child(3) { animation-delay: .4s; }
        .mascot:nth-child(4) { animation-delay: .6s; }

        @keyframes bob {
            0%, 100% { transform: translate(-50%, 0); }
            50% { transform: translate(-50%, -6px); }
        }

        /* Sticker floaters */
        .sticker {
            position: absolute;
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
            opacity: .75;
            animation: drift 8s linear infinite;
            pointer-events: none;
        }

        @keyframes drift {
            from { transform: translateY(0) rotate(0deg); }
            to { transform: translateY(-120px) rotate(15deg); }
        }

        @keyframes float {
            0% {
                opacity: 0;
                transform: translateY(100vh) rotate(0deg);
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="floating-hearts" id="floatingHearts"></div>
    <div class="mascot-strip" aria-hidden="true">
        <!-- 4 cute pixel mascots as inline SVGs so they work offline -->
        <svg class="mascot" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <!-- pink cat -->
            <rect width="16" height="16" fill="#ffeef7"/>
            <rect x="3" y="3" width="10" height="8" fill="#ff9dbb"/>
            <rect x="2" y="4" width="2" height="2" fill="#ff9dbb"/>
            <rect x="12" y="4" width="2" height="2" fill="#ff9dbb"/>
            <rect x="5" y="6" width="2" height="2" fill="#333"/>
            <rect x="9" y="6" width="2" height="2" fill="#333"/>
            <rect x="6" y="8" width="4" height="1" fill="#333"/>
        </svg>
        <svg class="mascot" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <!-- mint bunny -->
            <rect width="16" height="16" fill="#effbf6"/>
            <rect x="3" y="5" width="10" height="6" fill="#a8e6cf"/>
            <rect x="4" y="1" width="2" height="4" fill="#a8e6cf"/>
            <rect x="10" y="1" width="2" height="4" fill="#a8e6cf"/>
            <rect x="5" y="6" width="2" height="2" fill="#333"/>
            <rect x="9" y="6" width="2" height="2" fill="#333"/>
            <rect x="6" y="8" width="4" height="1" fill="#333"/>
        </svg>
        <svg class="mascot" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <!-- lemon chick -->
            <rect width="16" height="16" fill="#fffbea"/>
            <rect x="3" y="4" width="10" height="7" fill="#ffd93d"/>
            <rect x="5" y="6" width="2" height="2" fill="#333"/>
            <rect x="9" y="6" width="2" height="2" fill="#333"/>
            <rect x="6" y="8" width="4" height="1" fill="#333"/>
            <rect x="7" y="11" width="2" height="1" fill="#ff9a3d"/>
        </svg>
        <svg class="mascot" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <!-- lavender bear -->
            <rect width="16" height="16" fill="#f5f0ff"/>
            <rect x="3" y="4" width="10" height="8" fill="#c7ceea"/>
            <rect x="2" y="3" width="3" height="3" fill="#c7ceea"/>
            <rect x="11" y="3" width="3" height="3" fill="#c7ceea"/>
            <rect x="5" y="6" width="2" height="2" fill="#333"/>
            <rect x="9" y="6" width="2" height="2" fill="#333"/>
            <rect x="6" y="8" width="4" height="1" fill="#333"/>
        </svg>
    </div>
    
    <div class="container">
        <!-- Retro window header -->
        <div class="window-header">
            <h1 class="title">‚ú® Cute To-Do ‚ú®</h1>
            <div class="audio-controls">
                <button class="audio-btn" id="audioToggle" title="Play/Pause Music">üîà</button>
                <input type="range" id="audioVolume" class="audio-slider" min="0" max="1" step="0.01" value="0.4"/>
            </div>
        </div>

        <!-- Main to-do interface -->
        <div class="todo-container">
            <!-- Input section -->
            <div class="input-section">
                <input 
                    type="text" 
                    class="task-input" 
                    id="taskInput" 
                    placeholder="Enter a cute task..."
                    maxlength="50"
                >
                <button class="pixel-btn add-btn" id="addBtn">Add Task</button>
                <button class="pixel-btn clear-btn" id="clearBtn">Clear All</button>
            </div>

            <!-- Task list -->
            <ul class="task-list" id="taskList">
                <!-- Tasks will be dynamically added here -->
            </ul>
        </div>
    </div>

    <script>
        // Task management class
        class TodoApp {
            constructor() {
                this.tasks = this.loadTasks();
                this.taskIdCounter = this.getNextId();
                this.masterVolume = 0.4;
                this.sfx = this.loadSounds();
                this.bgm = this.createBgm();
                this.initializeEventListeners();
                this.renderTasks();
            }

            // Load tasks from localStorage
            loadTasks() {
                const saved = localStorage.getItem('cute-todo-tasks');
                return saved ? JSON.parse(saved) : [];
            }

            // Save tasks to localStorage
            saveTasks() {
                localStorage.setItem('cute-todo-tasks', JSON.stringify(this.tasks));
            }

            // Get next available ID
            getNextId() {
                const maxId = this.tasks.reduce((max, task) => Math.max(max, task.id || 0), 0);
                return maxId + 1;
            }

            // Initialize event listeners
            initializeEventListeners() {
                const taskInput = document.getElementById('taskInput');
                const addBtn = document.getElementById('addBtn');
                const clearBtn = document.getElementById('clearBtn');
                const audioToggle = document.getElementById('audioToggle');
                const audioVolume = document.getElementById('audioVolume');

                // Add task on button click
                addBtn.addEventListener('click', () => this.addTask());

                // Add task on Enter key
                taskInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.addTask();
                    }
                });

                // Clear all tasks
                clearBtn.addEventListener('click', () => this.clearAllTasks());

                // Add some cute floating hearts on page load
                this.createFloatingHearts();
                this.spawnStickers();

                // Audio UI wiring
                if (audioVolume) {
                    this.masterVolume = parseFloat(audioVolume.value);
                    audioVolume.addEventListener('input', () => {
                        this.masterVolume = parseFloat(audioVolume.value);
                        this.applyVolumes();
                    });
                }
                if (audioToggle) {
                    audioToggle.addEventListener('click', () => {
                        // user gesture: safe to start music
                        if (this.bgm.paused) {
                            this.bgm.play().then(() => {
                                audioToggle.textContent = 'üîä';
                            }).catch(() => {});
                        } else {
                            this.bgm.pause();
                            audioToggle.textContent = 'üîà';
                        }
                    });
                }
            }

            // Load tiny inline sound effects
            loadSounds() {
                const mk = (src) => {
                    const a = new Audio(src);
                    a.preload = 'auto';
                    return a;
                };
                // Beeps generated as short WAVs (data URIs) for offline use
                const add = mk('data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAClAAAAAAAAPwAAAP8AAAD/AP//AAD//wAAAP8AAAD/AAAA/wAAAP//AAD//wAAAP8AAAD/AAAA/wAAAP//AAD//wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA');
                const del = mk('data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAClAAAAAAAAPwAAAP8AAAD/AP//AAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA');
                const boom = mk('data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAClAAAAAAAAPwAAAP8AAAD/AP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAAA');
                return { add, del, boom };
            }

            // Create background music (tiny loop, starts on button press)
            createBgm() {
                const bgm = new Audio('data:audio/ogg;base64,T2dnUwACAAAAAAAAAABxd5m3AAAAAABWb3JiaXMAAAAAAUSsAAAAAAAAAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
                bgm.loop = true;
                bgm.preload = 'auto';
                bgm.volume = this.masterVolume * 0.6;
                return bgm;
            }

            // Apply master volume to all audio
            applyVolumes() {
                if (this.bgm) this.bgm.volume = this.masterVolume * 0.6;
                // sfx volumes are applied per play to ensure snappy changes
            }

            playSfx(name, base = 1) {
                const snd = this.sfx?.[name];
                if (!snd) return;
                try {
                    snd.currentTime = 0;
                    snd.volume = Math.max(0, Math.min(1, this.masterVolume * base));
                    snd.play().catch(() => {});
                } catch (e) {}
            }

            // Add a new task
            addTask() {
                const taskInput = document.getElementById('taskInput');
                const text = taskInput.value.trim();

                if (text === '') {
                    this.showNotification('Please enter a task! üí´', 'warning');
                    return;
                }

                if (text.length > 50) {
                    this.showNotification('Task too long! Keep it under 50 characters ‚ú®', 'warning');
                    return;
                }

                const newTask = {
                    id: this.taskIdCounter++,
                    text: text,
                    completed: false,
                    createdAt: new Date().toISOString()
                };

                this.tasks.unshift(newTask); // Add to beginning
                this.saveTasks();
                this.renderTasks();
                taskInput.value = '';

                // Create floating hearts animation
                this.createFloatingHearts();
                this.showNotification('Task added! ‚ú®', 'success');
                this.celebrate();
                this.playSfx('add', 0.9);
            }

            // Toggle task completion
            toggleTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    this.saveTasks();
                    this.renderTasks();
                }
            }

            // Edit task
            editTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (!task) return;

                const newText = prompt('Edit your task:', task.text);
                if (newText !== null && newText.trim() !== '') {
                    if (newText.trim().length > 50) {
                        this.showNotification('Task too long! Keep it under 50 characters ‚ú®', 'warning');
                        return;
                    }
                    task.text = newText.trim();
                    this.saveTasks();
                    this.renderTasks();
                    this.showNotification('Task updated! ‚ú®', 'success');
                }
            }

            // Delete task
            deleteTask(id) {
                if (confirm('Are you sure you want to delete this task? üíî')) {
                    const taskElement = document.querySelector(`[data-task-id="${id}"]`);
                    if (taskElement) {
                        taskElement.classList.add('removing');
                        setTimeout(() => {
                            this.tasks = this.tasks.filter(t => t.id !== id);
                            this.saveTasks();
                            this.renderTasks();
                            this.showNotification('Task deleted! ‚ú®', 'info');
                            this.poof(taskElement);
                            this.playSfx('del', 0.8);
                        }, 300);
                    }
                }
            }

            // Clear all tasks
            clearAllTasks() {
                if (this.tasks.length === 0) {
                    this.showNotification('No tasks to clear! ‚ú®', 'info');
                    return;
                }

                if (confirm('Are you sure you want to clear all tasks? This cannot be undone! üíî')) {
                    this.tasks = [];
                    this.saveTasks();
                    this.renderTasks();
                    this.showNotification('All tasks cleared! ‚ú®', 'info');
                    this.bigPoof();
                    this.playSfx('boom', 1.0);
                }
            }

            // Render all tasks
            renderTasks() {
                const taskList = document.getElementById('taskList');
                
                if (this.tasks.length === 0) {
                    taskList.innerHTML = `
                        <div class="empty-state">
                            No tasks yet!<br>
                            Add your first cute task above ‚ú®
                        </div>
                    `;
                    return;
                }

                taskList.innerHTML = this.tasks.map(task => `
                    <li class="task-item ${task.completed ? 'completed' : ''}" data-task-id="${task.id}">
                        <input 
                            type="checkbox" 
                            class="task-checkbox" 
                            ${task.completed ? 'checked' : ''}
                            onchange="todoApp.toggleTask(${task.id})"
                        >
                        <span class="task-text">${this.escapeHtml(task.text)}</span>
                        <div class="task-actions">
                            <button class="edit-btn" onclick="todoApp.editTask(${task.id})" title="Edit">‚úèÔ∏è</button>
                            <button class="delete-btn" onclick="todoApp.deleteTask(${task.id})" title="Delete">üóëÔ∏è</button>
                        </div>
                    </li>
                `).join('');
            }

            // Sprinkle floating pixel stickers (inline pixel art as data URIs)
            spawnStickers() {
                const stickerPool = [
                    'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="none"/><rect x="5" y="5" width="6" height="6" fill="%23ff9dbb"/><rect x="6" y="6" width="1" height="1" fill="%23fff"/><rect x="9" y="6" width="1" height="1" fill="%23fff"/><rect x="7" y="8" width="2" height="1" fill="%23333"/></svg>',
                    'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="none"/><rect x="4" y="6" width="8" height="5" fill="%23ffd93d"/><rect x="5" y="5" width="2" height="2" fill="%23ffd93d"/><rect x="9" y="5" width="2" height="2" fill="%23ffd93d"/></svg>',
                    'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="none"/><rect x="5" y="4" width="6" height="7" fill="%23c7ceea"/></svg>'
                ];

                const container = document.body;
                for (let i = 0; i < 8; i++) {
                    const img = document.createElement('img');
                    img.className = 'sticker';
                    img.src = stickerPool[i % stickerPool.length];
                    img.style.left = Math.random() * 100 + 'vw';
                    img.style.bottom = (Math.random() * 40 + 10) + 'px';
                    img.style.animationDelay = (Math.random() * 6) + 's';
                    img.style.opacity = (0.5 + Math.random() * 0.5).toFixed(2);
                    container.appendChild(img);
                }
            }

            // Tiny confetti celebration
            celebrate() {
                for (let i = 0; i < 12; i++) {
                    setTimeout(() => {
                        const dot = document.createElement('div');
                        const size = 6 + Math.random() * 6;
                        dot.style.cssText = `position: fixed; left: 50%; top: 90px; width: ${size}px; height: ${size}px; border-radius: 2px; background: ${['#ff9dbb','#ffd93d','#a8e6cf','#c7ceea'][i%4]}; transform: translateX(${(Math.random()-0.5)*150}px); opacity: 0; z-index: 9999; animation: confettiFall .8s ease-out forwards;`;
                        if (!document.getElementById('confetti-styles')) {
                            const style = document.createElement('style');
                            style.id = 'confetti-styles';
                            style.textContent = `@keyframes confettiFall { 0% { transform: translateY(-10px) scale(.8); opacity: 0; } 20% { opacity: 1; } 100% { transform: translateY(50px) scale(1); opacity: 0; } }`;
                            document.head.appendChild(style);
                        }
                        document.body.appendChild(dot);
                        setTimeout(() => dot.remove(), 800);
                    }, i * 30);
                }
            }

            // Small poof on delete
            poof(el) {
                const rect = el.getBoundingClientRect();
                for (let i = 0; i < 8; i++) {
                    const smoke = document.createElement('div');
                    smoke.style.cssText = `position: fixed; left: ${rect.left + rect.width/2}px; top: ${rect.top + rect.height/2}px; width: 6px; height: 6px; background: #ccc; border-radius: 50%; opacity: .8; z-index: 9999; animation: poof .4s ease-out forwards;`;
                    if (!document.getElementById('poof-styles')) {
                        const style = document.createElement('style');
                        style.id = 'poof-styles';
                        style.textContent = `@keyframes poof { to { transform: translate(${(Math.random()-0.5)*40}px, ${(Math.random()-0.5)*40}px); opacity: 0; } }`;
                        document.head.appendChild(style);
                    }
                    document.body.appendChild(smoke);
                    setTimeout(() => smoke.remove(), 400);
                }
            }

            // Big poof for clear all
            bigPoof() {
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const puff = document.createElement('div');
                        const x = window.innerWidth/2 + (Math.random()-0.5) * 120;
                        const y = window.innerHeight/2 + (Math.random()-0.5) * 80;
                        const s = 6 + Math.random()*10;
                        puff.style.cssText = `position: fixed; left: ${x}px; top: ${y}px; width: ${s}px; height: ${s}px; background: #eee; border-radius: 50%; opacity: .9; z-index: 9999; animation: bigPoof .6s ease-out forwards;`;
                        if (!document.getElementById('bigpoof-styles')) {
                            const style = document.createElement('style');
                            style.id = 'bigpoof-styles';
                            style.textContent = `@keyframes bigPoof { to { transform: translate(${(Math.random()-0.5)*160}px, ${(Math.random()-0.5)*160}px); opacity: 0; } }`;
                            document.head.appendChild(style);
                        }
                        document.body.appendChild(puff);
                        setTimeout(() => puff.remove(), 600);
                    }, i * 12);
                }
            }

            // Escape HTML to prevent XSS
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Create floating hearts animation
            createFloatingHearts() {
                const heartsContainer = document.getElementById('floatingHearts');
                const heartCount = 3;

                for (let i = 0; i < heartCount; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart';
                        heart.textContent = ['üíñ', 'üíï', 'üíó', 'üíù', 'üíò'][Math.floor(Math.random() * 5)];
                        heart.style.left = Math.random() * 100 + '%';
                        heart.style.animationDelay = Math.random() * 2 + 's';
                        heart.style.animationDuration = (Math.random() * 2 + 2) + 's';
                        
                        heartsContainer.appendChild(heart);

                        // Remove heart after animation
                        setTimeout(() => {
                            if (heart.parentNode) {
                                heart.parentNode.removeChild(heart);
                            }
                        }, 4000);
                    }, i * 200);
                }
            }

            // Show notification
            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(145deg, #ff9a9e, #fecfef);
                    border: 2px solid #333;
                    padding: 15px 20px;
                    font-family: 'Press Start 2P', monospace;
                    font-size: 8px;
                    color: #333;
                    box-shadow: 0 4px 0 #666;
                    z-index: 10000;
                    animation: slideInRight 0.3s ease-out;
                `;
                notification.textContent = message;

                // Add animation keyframes if not already added
                if (!document.getElementById('notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideInRight {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOutRight {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }

                document.body.appendChild(notification);

                // Remove notification after 3 seconds
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }

        // Initialize the app when DOM is loaded
        let todoApp;
        document.addEventListener('DOMContentLoaded', () => {
            todoApp = new TodoApp();
        });

        // Add some cute easter eggs
        document.addEventListener('keydown', (e) => {
            // Konami code easter egg
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight' || e.key === 'a' || e.key === 'b') {
                // Simple easter egg - create extra hearts
                if (Math.random() < 0.1) {
                    todoApp.createFloatingHearts();
                }
            }
        });

        // Add click effect to buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('pixel-btn') || e.target.classList.contains('edit-btn') || e.target.classList.contains('delete-btn')) {
                // Create a small sparkle effect
                const sparkle = document.createElement('div');
                sparkle.style.cssText = `
                    position: fixed;
                    left: ${e.clientX}px;
                    top: ${e.clientY}px;
                    width: 10px;
                    height: 10px;
                    background: radial-gradient(circle, #ffd700, transparent);
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 10000;
                    animation: sparkleEffect 0.5s ease-out forwards;
                `;

                // Add sparkle animation if not already added
                if (!document.getElementById('sparkle-styles')) {
                    const style = document.createElement('style');
                    style.id = 'sparkle-styles';
                    style.textContent = `
                        @keyframes sparkleEffect {
                            0% { transform: scale(0) rotate(0deg); opacity: 1; }
                            100% { transform: scale(3) rotate(180deg); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }

                document.body.appendChild(sparkle);
                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 500);
            }
        });
    </script>
</body>
</html>
